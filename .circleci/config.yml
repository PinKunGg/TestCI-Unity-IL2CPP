version: 2.1

jobs:
  build:
    docker:
      - image: circleci/node:latest

    steps:
      - checkout

      # Install Unity Hub
      - run:
          name: Install Unity Hub
          command: |
            curl -sL https://public-cdn.cloud.unity3d.com/hub/prod/UnityHub.AppImage -o UnityHub.AppImage
            chmod +x UnityHub.AppImage
            sudo mv UnityHub.AppImage /usr/local/bin/UnityHub

      # Install Unity using Unity Hub
      - run:
          name: Install Unity
          command: UnityHub install -v 2023.1.13f1 -m android android-sdk-ndk-tools android-open-jdk

      # Activate Unity license (if needed)
      # Uncomment and replace placeholders with your license information
      # - run:
      #     name: Activate Unity License
      #     command: UnityHub activate -username <YOUR_USERNAME> -password <YOUR_PASSWORD>

      # Run Unity build
      - run:
          name: Unity Build
          command: UnityHub -quit -batchmode -logFile -projectPath /root/project/. -executeMethod MyWorldBuildCommand.CustomBuildAndroid

workflows:
  version: 2
  build:
    jobs:
      - build
